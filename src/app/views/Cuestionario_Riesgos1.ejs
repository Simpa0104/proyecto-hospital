<%- include('../includes/head.ejs') %>
<title>Test de Riesgo</title>
</head>
<body>
    <%- include('../includes/contacto.ejs') %>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <form id="testForm" method="POST" action="/formulario1">
                    <h1 class="text-center mb-4">Detección de Riesgo</h1>

                    <div class="mb-3">
                        <label class="form-label">Nombre completo</label>
                        <input type="text" class="form-control" name="nombre" required>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Número de episodio</label>
                        <input type="number" class="form-control" name="episodio" min="1" required>
                    </div>

                    <% const preguntas = [ 
                        { num: 1, texto: "Niño(a)s y adolescentes..." },
                        { num: 2, texto: "Gestantes y puérperas..." },
                        { num: 3, texto: "Oncología y cuidado paliativo" },
                        { num: 4, texto: "Pacientes con quemaduras" },
                        { num: 5, texto: "Pacientes en cuidado crítico" },
                        { num: 6, texto: "Pacientes con diagnóstico mental" } 
                    ]; %>

                    <% preguntas.forEach(p => { %>
                        <div class="card mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Pregunta <%= p.num %></h5>
                                <p class="card-text"><%= p.texto %></p>
                                <div class="btn-group w-100">
                                    <input type="radio" name="pregunta<%= p.num %>" id="p<%= p.num %>-si" value="1" required>
                                    <label class="btn btn-outline-success" for="p<%= p.num %>-si">Sí</label>
                                    <input type="radio" name="pregunta<%= p.num %>" id="p<%= p.num %>-no" value="0" required>
                                    <label class="btn btn-outline-danger" for="p<%= p.num %>-no">No</label>
                                </div>
                            </div>
                        </div>
                    <% }); %>

                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        Evaluar
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const response = await fetch(e.target.action, {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams(new FormData(e.target))
            });
            const data = await response.json();
            if (data.success) window.location.href = data.nextUrl;
            else alert('Error: ' + (data.error || 'Error desconocido'));
        });
    </script>

    <%- include('../includes/footer.ejs') %>
</body>
</html>