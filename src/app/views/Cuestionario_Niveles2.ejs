<%- include('../includes/head.ejs') %>
<title>Test de Riesgo - Nivel 2</title>
</head>
<body>
    <%- include('../includes/contacto.ejs') %>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <form id="testForm" method="POST" action="/formulario2/<%= evaluacionId %>">
                    <h1 class="text-center mb-4">Detección de Riesgo - Nivel 2</h1>

                    <% const preguntas2 = [
                        { num: 7, texto: "Ansiedad o ánimo deprimido" },
                        { num: 8, texto: "Adherencia a tratamientos" },
                        { num: 9, texto: "Hospitalizaciones recientes" },
                        { num: 10, texto: "Autorización de asegurador" },
                        { num: 11, texto: "Lugar y apoyo post-egreso" },
                        { num: 12, texto: "Acompañante durante hospitalización" }
                    ]; %>

                    <% preguntas2.forEach(p => { %>
                        <div class="card mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Pregunta <%= p.num %></h5>
                                <p class="card-text"><%= p.texto %></p>
                                <div class="btn-group w-100">
                                    <input type="radio" name="pregunta<%= p.num %>" id="p<%= p.num %>-siempre" value="2" required>
                                    <label class="btn btn-outline-success" for="p<%= p.num %>-siempre">Siempre</label>
                                    <input type="radio" name="pregunta<%= p.num %>" id="p<%= p.num %>-ocasional" value="1" required>
                                    <label class="btn btn-outline-warning" for="p<%= p.num %>-ocasional">Ocasional</label>
                                    <input type="radio" name="pregunta<%= p.num %>" id="p<%= p.num %>-nunca" value="0" required>
                                    <label class="btn btn-outline-danger" for="p<%= p.num %>-nunca">Nunca</label>
                                </div>
                            </div>
                        </div>
                    <% }); %>

                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        Finalizar Evaluación
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const response = await fetch(e.target.action, {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams(new FormData(e.target))
            });
            const data = await response.json();
            if (data.success) window.location.href = data.nextUrl;
            else alert('Error: ' + (data.error || 'Error desconocido'));
        });
    </script>

    <%- include('../includes/footer.ejs') %>
</body>
</html>